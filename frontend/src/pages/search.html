<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Products - Ublio</title>
    <link rel="stylesheet" href="../css/main.css">
</head>

<body>
    <header class="header header-scrolled">
        <nav class="container">
            <div class="nav">
                <a href="/" class="logo">UBLIO</a>
                <ul class="nav-menu">
                    <li><a href="/" class="nav-link">Home</a></li>
                    <li><a href="/src/pages/products.html" class="nav-link">Products</a></li>
                    <li><a href="/src/pages/about.html" class="nav-link">About</a></li>
                    <li><a href="/src/pages/contact.html" class="nav-link">Contact</a></li>
                </ul>
                <div class="nav-actions">
                    <a href="/src/pages/cart.html" class="icon-btn cart-icon">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                        <span class="cart-count" id="cartCount">0</span>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main style="margin-top: 100px; min-height: 70vh;">
        <section class="section">
            <div class="container">
                <h1 class="mb-8">Search Products</h1>

                <!-- Search Input -->
                <div style="max-width: 600px; margin: 0 auto var(--space-10);">
                    <div style="position: relative;">
                        <input type="text" id="searchInput" placeholder="Search for products..."
                            style="width: 100%; padding: var(--space-4) var(--space-6); padding-right: var(--space-12); font-size: var(--text-lg); border: 2px solid var(--color-gray-300); border-radius: var(--radius-lg);"
                            autofocus>
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24"
                            style="position: absolute; right: var(--space-4); top: 50%; transform: translateY(-50%); opacity: 0.5;">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </div>
                </div>

                <!-- Results Count -->
                <div id="resultsCount" style="margin-bottom: var(--space-6); color: var(--color-gray-600);"></div>

                <!-- Search Results -->
                <div class="grid grid-4" id="searchResults"></div>

                <!-- No Results Message -->
                <div id="noResults" style="display: none; text-align: center; padding: var(--space-12);">
                    <svg width="80" height="80" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                        style="margin: 0 auto var(--space-6); opacity: 0.3;">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <h3>No products found</h3>
                    <p style="color: var(--color-gray-600); margin-top: var(--space-4);">Try searching with different
                        keywords</p>
                    <a href="/src/pages/products.html" class="btn btn-primary mt-6">Browse All Products</a>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 Ublio Audio. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script type="module">
        import productsData from '../data/products.json';
        import { createProductCard, updateCartCount, addToCart } from '../js/main.js';

        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        const resultsCount = document.getElementById('resultsCount');
        const noResults = document.getElementById('noResults');

        // Get search query from URL if exists
        const urlParams = new URLSearchParams(window.location.search);
        const initialQuery = urlParams.get('q') || '';
        if (initialQuery) {
            searchInput.value = initialQuery;
            performSearch(initialQuery);
        }

        // Search on input
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.trim();
            if (query.length > 0) {
                performSearch(query);
            } else {
                searchResults.innerHTML = '';
                resultsCount.textContent = '';
                noResults.style.display = 'none';
            }
        });

        function performSearch(query) {
            const lowerQuery = query.toLowerCase();

            // Search in product name, category, short description, and features
            const results = productsData.products.filter(product => {
                const searchableText = [
                    product.name,
                    product.category,
                    product.shortDescription,
                    product.longDescription,
                    ...product.features,
                    ...Object.values(product.specifications)
                ].join(' ').toLowerCase();

                return searchableText.includes(lowerQuery);
            });

            // Display results
            if (results.length > 0) {
                searchResults.innerHTML = results.map((product, index) => createProductCard(product, index)).join('');
                resultsCount.textContent = `Found ${results.length} product${results.length !== 1 ? 's' : ''}`;
                noResults.style.display = 'none';

                // Add event listeners for add to cart buttons
                document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const productId = btn.dataset.productId;
                        addToCart(productId);
                    });
                });
            } else {
                searchResults.innerHTML = '';
                resultsCount.textContent = '';
                noResults.style.display = 'block';
            }
        }

        updateCartCount();
    </script>
</body>

</html>