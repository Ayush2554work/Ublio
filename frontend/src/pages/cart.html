<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - Ublio</title>
    <link rel="stylesheet" href="../../css/main.css">
</head>

<body>
    <header class="header header-scrolled">
        <nav class="container">
            <div class="nav">
                <a href="/" class="logo">UBLIO</a>
                <ul class="nav-menu">
                    <li><a href="/" class="nav-link">Home</a></li>
                    <li><a href="/src/pages/products.html" class="nav-link">Products</a></li>
                    <li><a href="/src/pages/about.html" class="nav-link">About</a></li>
                    <li><a href="/src/pages/contact.html" class="nav-link">Contact</a></li>
                </ul>
                <div class="nav-actions">
                    <a href="/src/pages/cart.html" class="icon-btn cart-icon">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                        <span class="cart-count" id="cartCount">0</span>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main style="margin-top: 100px; min-height: 70vh;">
        <section class="section">
            <div class="container">
                <h1 class="mb-8">Shopping Cart</h1>
                <div class="cart-layout" style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-8);">
                    <div class="cart-items" id="cartItems"></div>
                    <div class="order-summary card" style="padding: var(--space-6); height: fit-content;">
                        <h3 class="mb-6">Order Summary</h3>
                        <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-4);">
                            <span>Subtotal:</span>
                            <span id="subtotal">₹0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-4);">
                            <span>Shipping:</span>
                            <span id="shipping">Free</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-4);">
                            <span>Tax (GST 18%):</span>
                            <span id="tax">₹0</span>
                        </div>
                        <hr
                            style="margin: var(--space-5) 0; border: none; border-top: 1px solid var(--color-gray-300);">
                        <div
                            style="display: flex; justify-content: space-between; font-size: var(--text-xl); font-weight: 700; margin-bottom: var(--space-6);">
                            <span>Total:</span>
                            <span id="total" style="color: var(--color-primary);">₹0</span>
                        </div>
                        <button class="btn btn-primary" style="width: 100%;"
                            onclick="window.location.href='/src/pages/checkout.html'" id="checkoutBtn">Proceed to
                            Checkout</button>
                        <a href="/src/pages/products.html" class="btn btn-ghost mt-4"
                            style="width: 100%; text-align: center;">Continue Shopping</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom" style="padding-top: 0;">
                <p>&copy; 2024 Ublio Audio. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script type="module">
        import { formatPrice } from '/src/js/main.js';

        let cart = JSON.parse(localStorage.getItem('ublioCart')) || [];

        function renderCart() {
            const cartItemsContainer = document.getElementById('cartItems');
            const checkoutBtn = document.getElementById('checkoutBtn');

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = `
          <div class="empty-cart" style="text-align: center; padding: var(--space-12); background: var(--color-gray-100); border-radius: var(--radius-lg);">
            <svg width="80" height="80" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" style="margin: 0 auto var(--space-6); opacity: 0.5;">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            <h3>Your cart is empty</h3>
            <p style="color: var(--color-gray-600); margin: var(--space-4) 0;">Add some luxury audio equipment to get started</p>
            <a href="/src/pages/products.html" class="btn btn-primary mt-6">Browse Products</a>
          </div>
        `;
                checkoutBtn.disabled = true;
                updateSummary();
                return;
            }

            checkoutBtn.disabled = false;
            cartItemsContainer.innerHTML = cart.map(item => `
        <div class="cart-item card" style="display: grid; grid-template-columns: 120px 1fr auto; gap: var(--space-5); padding: var(--space-5); margin-bottom: var(--space-4);">
          <img src="${item.image}" alt="${item.name}" style="width: 100%; height: 120px; object-fit: cover; border-radius: var(--radius-md);">
          <div>
            <h4>${item.name}</h4>
            <p style="color: var(--color-primary); font-size: var(--text-xl); font-weight: 700; margin-top: var(--space-2);">₹${formatPrice(item.price)}</p>
            <div style="display: flex; align-items: center; gap: var(--space-3); margin-top: var(--space-4);">
              <button class="btn btn-sm btn-ghost qty-decrease" data-id="${item.id}">−</button>
              <span class="quantity-display" style="min-width: 30px; text-align: center; font-weight: 600;">${item.quantity}</span>
              <button class="btn btn-sm btn-ghost qty-increase" data-id="${item.id}">+</button>
            </div>
          </div>
          <div style="text-align: right;">
            <p style="font-weight: 700; font-size: var(--text-lg);">₹${formatPrice(item.price * item.quantity)}</p>
            <button class="btn btn-ghost btn-sm mt-4 remove-item" data-id="${item.id}" style="color: var(--color-error);">Remove</button>
          </div>
        </div>
      `).join('');

            attachEventListeners();
            updateSummary();
        }

        function attachEventListeners() {
            // Quantity increase buttons
            document.querySelectorAll('.qty-increase').forEach(btn => {
                btn.addEventListener('click', function () {
                    const productId = this.getAttribute('data-id');
                    updateQuantity(productId, 1);
                });
            });

            // Quantity decrease buttons
            document.querySelectorAll('.qty-decrease').forEach(btn => {
                btn.addEventListener('click', function () {
                    const productId = this.getAttribute('data-id');
                    updateQuantity(productId, -1);
                });
            });

            // Remove buttons
            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', function () {
                    const productId = this.getAttribute('data-id');
                    removeItem(productId);
                });
            });
        }

        function updateQuantity(productId, change) {
            const item = cart.find(i => i.id === productId);
            if (!item) return;

            item.quantity += change;

            if (item.quantity <= 0) {
                cart = cart.filter(i => i.id !== productId);
            }

            localStorage.setItem('ublioCart', JSON.stringify(cart));
            renderCart();
        }

        function removeItem(productId) {
            if (confirm('Remove this item from cart?')) {
                cart = cart.filter(i => i.id !== productId);
                localStorage.setItem('ublioCart', JSON.stringify(cart));
                renderCart();
            }
        }

        function updateSummary() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = subtotal >= 20000 ? 0 : (subtotal > 0 ? 100 : 0);
            const tax = Math.round(subtotal * 0.18);
            const total = subtotal + shipping + tax;

            document.getElementById('subtotal').textContent = `₹${formatPrice(subtotal)}`;
            document.getElementById('shipping').textContent = shipping === 0 ? 'Free' : `₹${formatPrice(shipping)}`;
            document.getElementById('tax').textContent = `₹${formatPrice(tax)}`;
            document.getElementById('total').textContent = `₹${formatPrice(total)}`;

            // Update cart count in header
            const cartCount = document.getElementById('cartCount');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            cartCount.style.display = totalItems > 0 ? 'flex' : 'none';
        }

        // Initial render
        renderCart();
    </script>
</body>

</html>